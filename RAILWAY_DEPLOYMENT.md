# Railway 배포 상세 가이드

이 문서는 Railway를 사용하여 금융 데이터 수집 시스템을 온라인에 배포하는 방법을 단계별로 상세히 안내합니다.

## 📋 사전 준비사항

1. ✅ GitHub 저장소에 코드 업로드 완료
   - 저장소 URL 예: `https://github.com/abenuhappy/stock-data-collector`
2. ✅ `Procfile`, `requirements.txt`, `runtime.txt` 파일 확인

## 🚂 1단계: Railway 계정 생성

### 1-1. Railway 웹사이트 접속
1. 브라우저에서 https://railway.app 접속
2. 우측 상단의 **"Login"** 또는 **"Start a New Project"** 클릭

### 1-2. GitHub로 로그인
1. **"Login with GitHub"** 버튼 클릭
2. GitHub 로그인 화면에서:
   - GitHub 계정으로 로그인
   - Railway가 GitHub 계정에 접근할 수 있도록 권한 승인
   - "Authorize Railway" 클릭

### 1-3. Railway 대시보드 확인
- 로그인 후 Railway 대시보드가 표시됩니다
- 아직 프로젝트가 없으면 빈 화면이 보입니다

## 🆕 2단계: 새 프로젝트 생성

### 2-1. 프로젝트 생성 시작
1. 대시보드에서 **"New Project"** 버튼 클릭
2. 또는 우측 상단의 **"+"** 아이콘 클릭

### 2-2. 배포 소스 선택
다음 옵션 중 하나를 선택:

#### 옵션 A: GitHub 저장소에서 배포 (추천) ⭐
1. **"Deploy from GitHub repo"** 선택
2. GitHub 저장소 목록이 표시됩니다
3. `stock-data-collector` 저장소 찾기
4. 저장소 옆의 **"Deploy"** 버튼 클릭

#### 옵션 B: 빈 프로젝트 생성 후 GitHub 연결
1. **"Empty Project"** 선택
2. 프로젝트 이름 입력 (선택사항)
3. 프로젝트 생성 후 GitHub 연결:
   - Settings 탭 클릭
   - "Connect GitHub Repo" 클릭
   - 저장소 선택

### 2-3. 자동 배포 시작
- Railway가 자동으로 다음을 감지합니다:
  - ✅ `Procfile` 파일 → 실행 명령 자동 설정
  - ✅ `requirements.txt` → 패키지 자동 설치
  - ✅ Python 프로젝트 → Python 환경 자동 설정

## ⚙️ 3단계: 배포 설정 확인 및 수정

### 3-1. 배포 로그 확인
1. 프로젝트 대시보드에서 **"Deployments"** 탭 클릭
2. 최신 배포 항목 클릭
3. **"View Logs"** 클릭하여 배포 진행 상황 확인

**정상적인 로그 예시:**
```
Building...
Installing dependencies...
Installing Flask>=2.0.0
Installing flask-cors>=3.0.0
...
Starting...
🚀 금융 데이터 수집 시스템이 프로덕션 모드로 시작되었습니다.
```

### 3-2. 환경 변수 설정 (선택사항)

#### 프로덕션 모드 활성화
1. 프로젝트 대시보드에서 **"Variables"** 탭 클릭
2. **"New Variable"** 클릭
3. 설정:
   - **Key**: `FLASK_ENV`
   - **Value**: `production`
4. **"Add"** 클릭

#### 기타 환경 변수 (필요한 경우)
- `PORT`: Railway가 자동으로 설정 (수정 불필요)
- `ENVIRONMENT`: `production` (선택사항)

### 3-3. 빌드 설정 확인
1. **Settings** 탭 클릭
2. **"Build & Deploy"** 섹션 확인:
   - **Build Command**: (비워두기 - 자동 감지)
   - **Start Command**: `python stock_app.py` (Procfile에서 자동 설정됨)
   - **Root Directory**: (비워두기)

## 🌐 4단계: 도메인 설정

### 4-1. 기본 도메인 생성
1. 프로젝트 대시보드에서 **"Settings"** 탭 클릭
2. **"Networking"** 섹션으로 스크롤
3. **"Generate Domain"** 버튼 클릭
4. 자동으로 생성된 도메인 확인:
   - 예: `stock-data-collector-production.up.railway.app`

### 4-2. 커스텀 도메인 설정 (선택사항)
1. **"Custom Domain"** 섹션에서
2. **"Add Custom Domain"** 클릭
3. 도메인 입력 (예: `stock.yourdomain.com`)
4. DNS 설정 안내에 따라 CNAME 레코드 추가

## ✅ 5단계: 배포 확인 및 테스트

### 5-1. 배포 상태 확인
1. 대시보드에서 배포 상태 확인:
   - 🟢 **Active**: 배포 성공
   - 🟡 **Building**: 배포 중
   - 🔴 **Failed**: 배포 실패 (로그 확인 필요)

### 5-2. 애플리케이션 접속
1. **"Settings"** > **"Networking"**에서 도메인 확인
2. 브라우저에서 도메인 URL로 접속:
   - 예: `https://stock-data-collector-production.up.railway.app`
3. 애플리케이션이 정상적으로 로드되는지 확인

### 5-3. 기능 테스트
1. **기간 선택**: 시작일과 종료일 선택
2. **지표 선택**: 원자재, 주식, 환율/금리 선택
3. **데이터 추출**: "📥 데이터 추출" 버튼 클릭
4. **결과 확인**: 데이터가 정상적으로 수집되는지 확인
5. **파일 다운로드**: CSV 파일 다운로드 테스트

## 🔄 6단계: 업데이트 배포

### 6-1. 코드 수정 후 GitHub에 푸시
```bash
# 코드 수정 후
git add .
git commit -m "업데이트 내용"
git push
```

### 6-2. 자동 재배포
- Railway가 GitHub 저장소를 모니터링하고 있습니다
- 코드가 푸시되면 자동으로 재배포가 시작됩니다
- **"Deployments"** 탭에서 재배포 진행 상황 확인

### 6-3. 수동 재배포 (필요한 경우)
1. **"Deployments"** 탭 클릭
2. **"Redeploy"** 버튼 클릭
3. 재배포 시작

## 📊 7단계: 모니터링 및 관리

### 7-1. 로그 확인
1. **"Deployments"** 탭에서 배포 선택
2. **"View Logs"** 클릭
3. 실시간 로그 확인:
   - 애플리케이션 오류
   - 요청 로그
   - 성능 정보

### 7-2. 메트릭 확인
1. **"Metrics"** 탭 클릭
2. 확인 가능한 정보:
   - CPU 사용량
   - 메모리 사용량
   - 네트워크 트래픽
   - 요청 수

### 7-3. 설정 관리
**Settings** 탭에서:
- 환경 변수 관리
- 도메인 설정
- 빌드 설정
- 팀 멤버 초대

## 💰 8단계: 요금제 및 제한사항

### 무료 티어 (Hobby)
- **월 $5 크레딧** (충분함)
- **500시간 실행 시간**
- **무제한 배포**
- **커스텀 도메인 지원**

### 유료 플랜 (필요한 경우)
- **Developer**: $20/월
- **Team**: $20/월 + 사용자당 $10/월
- **Enterprise**: 맞춤형

### 제한사항
- **슬립 모드 없음**: 항상 실행 중
- **데이터 저장**: 임시 파일 시스템 (재배포 시 삭제됨)
- **타임아웃**: 요청당 60초 제한

## ⚠️ 9단계: 문제 해결

### 배포 실패

#### 문제: "Build failed"
**해결 방법:**
1. **"Deployments"** > **"View Logs"** 확인
2. 일반적인 원인:
   - `requirements.txt`에 오타
   - Python 버전 호환성 문제
   - 패키지 설치 실패
3. 로그에서 오류 메시지 확인 후 수정

#### 문제: "Application error"
**해결 방법:**
1. **"View Logs"**에서 애플리케이션 오류 확인
2. 일반적인 원인:
   - 포트 설정 오류 (Railway가 자동 설정)
   - 환경 변수 누락
   - 파일 경로 오류
3. `stock_app.py`에서 `PORT` 환경 변수 사용 확인

### 애플리케이션 오류

#### 문제: "502 Bad Gateway"
**해결 방법:**
1. 애플리케이션이 정상적으로 시작되었는지 로그 확인
2. `host='0.0.0.0'` 설정 확인
3. `PORT` 환경 변수 사용 확인

#### 문제: "데이터 수집 실패"
**해결 방법:**
1. yfinance API 제한 확인
2. 인터넷 연결 확인 (Railway 서버 측)
3. 로그에서 오류 메시지 확인

### 성능 문제

#### 문제: "응답이 느림"
**해결 방법:**
1. **"Metrics"** 탭에서 리소스 사용량 확인
2. 많은 지표 선택 시 타임아웃 가능
3. 요청 시간 단축을 위해 데이터 샘플링 고려

## 🔧 10단계: 고급 설정

### 데이터 영구 저장 (선택사항)

현재는 `data/` 폴더에 저장되지만 재배포 시 삭제됩니다.

**해결 방법:**
1. **Railway Postgres** 추가:
   - 프로젝트에서 **"+ New"** > **"Database"** > **"Add Postgres"**
   - 데이터베이스 URL 환경 변수 자동 설정
2. 코드 수정하여 데이터베이스 사용

### 환경별 설정

**개발/프로덕션 분리:**
1. **"Variables"**에서 환경 변수 설정
2. `FLASK_ENV=production` 설정
3. 코드에서 환경 변수 확인

### CI/CD 파이프라인

**자동 배포 설정:**
- GitHub에 푸시하면 자동 배포
- 특정 브랜치만 배포하도록 설정 가능
- Settings > Source에서 브랜치 선택

## 📝 체크리스트

배포 전 확인사항:

- [ ] GitHub 저장소에 코드 업로드 완료
- [ ] `Procfile` 파일 존재
- [ ] `requirements.txt` 파일 존재
- [ ] `runtime.txt` 파일 존재 (선택사항)
- [ ] Railway 계정 생성 완료
- [ ] GitHub 저장소 연결 완료
- [ ] 배포 성공 확인
- [ ] 도메인 생성 완료
- [ ] 애플리케이션 접속 테스트 완료
- [ ] 기능 테스트 완료

## 🎯 다음 단계

배포 완료 후:

1. ✅ **도메인 공유**: 생성된 URL을 다른 사람들과 공유
2. ✅ **모니터링**: 정기적으로 로그와 메트릭 확인
3. ✅ **백업**: 중요한 데이터는 다운로드하여 보관
4. ✅ **업데이트**: 코드 수정 후 자동 재배포 확인

## 📚 참고 자료

- Railway 공식 문서: https://docs.railway.app
- Railway Discord 커뮤니티: https://discord.gg/railway
- Railway Status: https://status.railway.app

## 💡 팁

1. **무료 티어 최적화**:
   - 불필요한 로그 제거
   - 효율적인 코드 작성

2. **배포 속도 향상**:
   - `.railwayignore` 파일로 불필요한 파일 제외
   - 의존성 캐싱 활용

3. **보안**:
   - 민감한 정보는 환경 변수로 관리
   - `.env` 파일은 Git에 커밋하지 않기

4. **성능 모니터링**:
   - 정기적으로 Metrics 확인
   - 비정상적인 리소스 사용 시 조치

## ❓ 자주 묻는 질문

### Q: 무료 티어로 충분한가요?
**A**: 네, 소규모 프로젝트에는 충분합니다. 월 $5 크레딧으로 충분히 운영 가능합니다.

### Q: 슬립 모드가 있나요?
**A**: 아니요, Railway는 슬립 모드가 없습니다. 항상 실행 중입니다.

### Q: 데이터는 어떻게 저장되나요?
**A**: 현재는 임시 파일 시스템에 저장됩니다. 영구 저장이 필요하면 데이터베이스 추가를 고려하세요.

### Q: 커스텀 도메인을 사용할 수 있나요?
**A**: 네, 무료 티어에서도 커스텀 도메인을 사용할 수 있습니다.

### Q: 여러 환경(개발/프로덕션)을 만들 수 있나요?
**A**: 네, 여러 프로젝트를 생성하거나 브랜치별로 배포할 수 있습니다.

